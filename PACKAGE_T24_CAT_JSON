create or replace PACKAGE T24_CAT_JSON AS 
  
  -- TECNICA24
  -- http://www.tecnica24.es
  -- JESUS MORENO DIAZ
  -- @jesusmoreno
  -- Version 1.0 29/01/2021 21:50
  
  TYPE T_DATA IS TABLE OF CLOB INDEX BY VARCHAR2(200);
  TYPE T_INDEX IS TABLE OF VARCHAR2(200);
  G_INDEX T_INDEX;
  G_DATA T_DATA;
  G_SOURCE T_DATA;
  
  -- SETS ALL GLOBAL DATA
  PROCEDURE INITIALIZE;
  
  -- ADD JSON RESULT FROM SQL
  PROCEDURE ADD( P_INDEX IN VARCHAR2, P_SQL IN CLOB );
  
  -- DISPLAY ALL ITEMS
  PROCEDURE DISPLAY( P_CODE IN VARCHAR2 DEFAULT NULL );
  
  -- CHANGE MARKDOWN ITEMS WITH VALUES
  FUNCTION PARSE( P_MARKDOWN IN CLOB, P_DEBUG IN NUMBER DEFAULT 0 ) RETURN CLOB;
  
  -- GET JSON FROM SQL
  FUNCTION SQL_JSON( P_SQL IN VARCHAR2 
                   , P_OPTIONS IN VARCHAR2 DEFAULT 'NONE'
                   , P_START IN VARCHAR2 DEFAULT '['
                   , P_ROW IN VARCHAR2 DEFAULT '{$CONTENT$}'
                   , P_HEAD IN VARCHAR2 DEFAULT ''
                   , P_COL IN VARCHAR2 DEFAULT '"$NAME$": "$CONTENT$"'
                   , P_END IN VARCHAR2 DEFAULT ']'
                   , P_SKIP IN VARCHAR2 DEFAULT ','
                   , P_COLS IN NUMBER DEFAULT 1
                   ) RETURN CLOB;

  -- GET VALUE FROM JSON USING NOTATION {CODE.ITEM} 
  FUNCTION GET_VALUE( P_CODE IN VARCHAR2, P_PATH IN VARCHAR2, P_DEBUG IN NUMBER DEFAULT 0 ) RETURN VARCHAR2;

  -- GET ITEM NUMBER FROM STRING USING SEPARATOR
  FUNCTION GET_ITEM_NUM( P_STRING IN VARCHAR2 
                       , P_ITEM IN NUMBER 
                       , P_SEPARATOR IN VARCHAR2 DEFAULT ','
                       ) RETURN VARCHAR2;

END T24_CAT_JSON;
